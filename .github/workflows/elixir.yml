name: Elixir CI

on:
  push:
    branches:
      - master

jobs:
  # test:
  #   runs-on: ubuntu-latest

  #   services:
  #     db:
  #       image: postgres:11
  #       ports: ['5432:5432']
  #       options: >-
  #         --health-cmd pg_isready
  #         --health-interval 10s
  #         --health-timeout 5s
  #         --health-retries 5

  #   steps:
  #     - uses: actions/checkout@v1.0.0
  #     - uses: actions/setup-elixir@v1.0.0
  #       with:
  #         otp-version: 22.x
  #         elixir-version: 1.9.x
  #     # - run: mix deps.get
  #     # - run: mix test

  release:
    env:
      HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      HEROKU_EMAIL: ${{ secrets.HEROKU_EMAIL }}
    runs-on: ubuntu-latest

    # needs: test

    steps:
      - uses: actions/checkout@v1.0.0
      - run: cat $GITHUB_WORKSPACE/.github/heroku/.netrc
      - run: cp $GITHUB_WORKSPACE/.github/heroku/.netrc ~/.netrc
      - run: pwd
      - run: git status
      - run: git log
      - run: git remote add heroku https://git.heroku.com/example-actions-phoenix.git
      - run: git push heroku HEAD:master
